# コマンドライン引数でのファイルオープン仕様

## 目的
- アプリ起動時にコマンドラインでファイルパスが渡された場合、そのファイルを開く。
- ファイルが存在しない場合は警告を赤字で出力し、空ファイルとして開く。

## 対象/前提
- 対象OS: macOS
- 依存方向: UI -> Core のみ（Core は OS/CLI に依存しない）
- Core は「開くべきパス」「読み込んだテキスト/エンコード」を受け取って状態更新する役割に限定する。

## CLI 仕様
- 起動コマンド: `notepad-macos [path]`
- `path`:
  - 任意（未指定の場合は空の新規バッファを開く）
  - 相対パスは「起動時のカレントディレクトリ」基準で解決
  - 先頭と末尾の空白はそのまま扱う（シェル側の引用を前提）
- 複数引数:
  - 2個目以降は無視し、最初の `path` のみを処理する
  - 2個目以降がある場合は警告を赤字で出力する（詳細は後述）

## 起動フロー（概略）
1. `src/main.rs` で `std::env::args()` を取得し、`path` を抽出
2. `src/app.rs` で `path` を検証し、以下の分岐を行う
   - 存在する: 読み込み + エンコード推定 → Core にロード
   - 存在しない: 警告を赤字で出力 → 空バッファで新規作成
   - 読み込み失敗/変換失敗: **UI/アプリ層で `SystemError` を生成して通知**

## エンコード推定/読み込み
- 読み込みは UI/アプリ層で行い、Core へ UTF-8 の `String` とメタ情報を渡す。
- `encoding_rs` により以下の順で推定/変換する。
  1. BOM がある場合はそれを最優先
  2. BOM がない場合は `encoding_rs::UTF_8` を優先し、無効バイトがあれば代表的な文字コード候補（例: Shift_JIS, EUC-JP）を試行
  3. 変換に失敗した場合は `SystemErrorKind::Encoding`
- 推定結果（`Encoding`）は Core 側のドキュメント状態に保持する（保存時の既定値に利用）。

## ファイル存在チェック
- `std::fs::metadata` で存在確認を行う。
- 存在しない場合は新規バッファを作成し、以下の警告を赤字で出力する。

## 警告出力（赤字）
- 警告は **GUI 上のステータス表示**として赤字で表示する（コンソール出力は行わない）。
- 表示位置は検索ナビ領域（下部ナビ）に統一する。
- 表示は短時間（数秒）で自動的に消える。
- 形式（例）:
  - ファイル未存在: `file not found: <path>`
  - 複数引数の無視: `extra arguments are ignored: <arg1>, <arg2>...`

## Core への受け渡し
- ファイルが存在する場合:
  - `Core::open_document(path, text, encoding, dirty=false)` のような API を想定
- ファイルが存在しない場合:
  - `Core::open_document(path, "", default_encoding, dirty=false)` を呼ぶ
  - `default_encoding` は `UTF-8` を使用

## エラーハンドリング
- I/O 失敗やエンコード変換失敗は **UI/アプリ層で発生・処理**する
  - UI/アプリ層が `SystemError` を生成し、メッセージ整形/通知/再試行判断を行う
  - Core はファイルI/Oやエンコード変換に関知しないため、これらの `SystemErrorKind::Io` / `Encoding` は Core から返却されない
- Core が返すのは **ドメイン上の不正**のみ（例: `DomainErrorKind::InvalidOperation`）

## 表示/UX
- 画面上のドキュメント表示は通常のファイルオープンと同様
- 未存在時は空ファイルとして開かれるが、タイトルバーやステータスにパスは表示する
- 警告は GUI 内で赤字表示する

## テスト方針（実装時）
- 引数なし → 空バッファが開く
- 既存ファイル → 内容/エンコードが正しくロードされる
- 未存在ファイル → 警告が出て空バッファが開く
- 複数引数 → 2個目以降の警告が出る
